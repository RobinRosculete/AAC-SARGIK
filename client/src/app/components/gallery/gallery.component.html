<ion-header>
  <ion-toolbar>
    <ion-title>Gallery</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col size="6" size-sm="4" *ngFor="let image of images; let i = index">
        <ion-button expand="block" class="image-button" (click)="openModal(i)">
          <ion-img
            draggable="false"
            (dragstart)="(false)"
            class="unselectable"
            [src]="image.imageUrl"
          ></ion-img>
        </ion-button>
        <div>
          <ion-button (click)="readCaption(image.caption)">
            <ion-icon name="volume-high-outline" slot="start"></ion-icon>
            <p>{{ image.caption }}</p>
          </ion-button>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ng-container *ngFor="let modal of modals">
    <ion-modal (willDismiss)="onWillDismiss($event, modal.index)">
      <ng-template>
        <ion-content>
          <ion-img draggable="false" *ngIf="images[modal.index].imageUrl && !showImageCropper" (dragstart)="(false)" class="modal-image" id="modal-image" [src]="images[modal.index].imageUrl"></ion-img>
          <image-cropper
            *ngIf="images[modal.index].imageUrl && showImageCropper"
            [imageURL]="images[modal.index].imageUrl"
            [imageChangedEvent]="imageChangedEvent"
            [maintainAspectRatio]="true"
            [aspectRatio]="4 / 3"
            format="png"
            (imageCropped)="getPosition($event, modal.index)"
          ></image-cropper>
          <ion-button class="red-box bounding-box" *ngIf="showRedBox" [style.left.px]="redBoxLeft" [style.top.px]="redBoxTop" [style.width.px]="redBoxWidth" [style.height.px]="redBoxHeight"></ion-button>
          <div style="text-align: center" *ngIf="cropperButtons">
            <ion-button
              class="center"
              (click)="readCaption(images[modal.index].caption)"
            >
              <ion-icon name="volume-high-outline" slot="start"></ion-icon>
              <p>{{ images[modal.index].caption }}</p>
            </ion-button>
            <ion-button class="center" (click)="toggleImageCropper()">
              <p>Toggle Cropper</p>
            </ion-button>
            <ion-button class="center" (click)="showBox()">
              <p>Confirm</p>
            </ion-button>
          </div>
          <ion-grid *ngIf="images[modal.index].imageUrl && showInputBox">
            <ion-input
              placeholder="Enter Text"
              [(ngModel)]="boundingBoxInput"
            ></ion-input>
            <ion-row class="ion-justify-content-center">
              <!-- <ion-col class="ion-align-self-center">
                <ion-button
                  (click)="openTextModal()"
                  id="generate-caption"
                  expand="block"
                >
                  <ion-icon name="logo-ionitron"></ion-icon>
                  &nbsp;A.I. Text Generation
                </ion-button>
              </ion-col> -->
              <ion-col class="ion-align-self-center" (click)="sendBoundingBoxInfo(images[modal.index].imageID)">
                <ion-button>
                  Send
                </ion-button>
              </ion-col>
              <ion-col class="ion-align-self-center">
                <ion-button>
                  Back
                </ion-button>
              </ion-col>
              <ion-col class="ion-align-self-center">
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-content>
      </ng-template>
    </ion-modal>
  </ng-container>
</ion-content>

