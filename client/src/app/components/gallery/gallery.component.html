<ion-header>
  <ion-toolbar>
    <ion-title>Gallery</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col size="6" size-sm="4" *ngFor="let image of images; let i = index">
        <ion-button expand="block" class="image-button" (click)="openModal(i)">
          <ion-img
            draggable="false"
            (dragstart)="(false)"
            class="unselectable"
            [src]="image.imageUrl"
          ></ion-img>
        </ion-button>
        <div>
          <ion-button (click)="readCaption(image.caption)">
            <ion-icon name="volume-high-outline" slot="start"></ion-icon>
            <p>{{ image.caption }}</p>
          </ion-button>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ng-container *ngFor="let modal of modals">
    <ion-modal (willDismiss)="onWillDismiss($event, modal.index)">
      <ng-template>
        <ion-content>
          <ion-img draggable="false" *ngIf="images[modal.index].imageUrl && !showImageCropper" (dragstart)="(false)" class="modal-image" id="modal-image" [src]="images[modal.index].imageUrl"></ion-img>
          <image-cropper
            *ngIf="images[modal.index].imageUrl && showImageCropper"
            [imageURL]="images[modal.index].imageUrl"
            [imageChangedEvent]="imageChangedEvent"
            [maintainAspectRatio]="true"
            [aspectRatio]="4 / 3"
            format="png"
            (imageLoaded)="imageLoaded($event)"
            (cropperReady)="cropperReady()"
            (loadImageFailed)="loadImageFailed()"
            (imageCropped)="getPosition($event, modal.index)"
          ></image-cropper>
          <ion-button class="red-box bounding-box" *ngIf="showRedBox" [style.left.px]="redBoxLeft" [style.top.px]="redBoxTop" [style.width.px]="redBoxWidth" [style.height.px]="redBoxHeight"></ion-button>
          <div style="text-align: center">
            <ion-button
              class="center"
              (click)="readCaption(images[modal.index].caption)"
            >
              <ion-icon name="volume-high-outline" slot="start"></ion-icon>
              <p>{{ images[modal.index].caption }}</p>
            </ion-button>
            <ion-button class="center" (click)="toggleImageCropper()">
              <p>Toggle Cropper</p>
            </ion-button>
            <ion-button class="center" (click)="showBox()">
              <p>Confirm</p>
            </ion-button>
          </div>
        </ion-content>
      </ng-template>
    </ion-modal>
  </ng-container>
</ion-content>

